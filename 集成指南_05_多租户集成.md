# å¤šç§Ÿæˆ·é›†æˆæŒ‡å—

> æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•åœ¨ SaaS å¹³å°å’Œä¼ä¸šç‰ˆåº”ç”¨ä¸­å®ç°å¤šç§Ÿæˆ·è®¤è¯ï¼ŒåŒ…æ‹¬ç§Ÿæˆ·éš”ç¦»ã€é…ç½®ç®¡ç†å’Œè·¯ç”±ç­–ç•¥ã€‚

## ğŸ“‹ ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [ç§Ÿæˆ·æ¶æ„](#ç§Ÿæˆ·æ¶æ„)
- [å®ç°æ–¹æ¡ˆ](#å®ç°æ–¹æ¡ˆ)
- [ç§Ÿæˆ·è·¯ç”±](#ç§Ÿæˆ·è·¯ç”±)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ğŸ¯ æ¦‚è¿°

### ä»€ä¹ˆæ˜¯å¤šç§Ÿæˆ·ï¼Ÿ

å¤šç§Ÿæˆ·ï¼ˆMulti-Tenancyï¼‰æ˜¯æŒ‡å¤šä¸ªå®¢æˆ·ï¼ˆç§Ÿæˆ·ï¼‰å…±äº«åŒä¸€ä¸ªåº”ç”¨å®ä¾‹ï¼Œä½†æ•°æ®å’Œé…ç½®å®Œå…¨éš”ç¦»ã€‚

### OneID çš„å¤šç§Ÿæˆ·ç‰¹æ€§

OneID åŸç”Ÿæ”¯æŒå¤šç§Ÿæˆ·æ¶æ„ï¼š

- ğŸ¢ **ç§Ÿæˆ·éš”ç¦»**ï¼šç”¨æˆ·ã€å®¢æˆ·ç«¯ã€é…ç½®å®Œå…¨éš”ç¦»
- ğŸ¨ **ç‹¬ç«‹å“ç‰Œ**ï¼šæ¯ä¸ªç§Ÿæˆ·å¯è‡ªå®šä¹‰ç™»å½•é¡µæ ·å¼
- âš™ï¸ **çµæ´»é…ç½®**ï¼šç§Ÿæˆ·çº§çš„å¯†ç ç­–ç•¥ã€ä¼šè¯é…ç½®
- ğŸ”’ **æ•°æ®éš”ç¦»**ï¼šè¡Œçº§å®‰å…¨ï¼ˆRow-Level Securityï¼‰

### ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| SaaS å¹³å° | ä¸ºä¼ä¸šå®¢æˆ·æä¾›ç‹¬ç«‹çš„è®¤è¯ç©ºé—´ | Salesforce, Shopify |
| ä¼ä¸šç‰ˆåº”ç”¨ | å¤§å‹ä¼ä¸šçš„ä¸åŒéƒ¨é—¨ | é›†å›¢ä¸‹çš„å„å­å…¬å¸ |
| ç™½æ ‡æ–¹æ¡ˆ | ä¸ºåˆä½œä¼™ä¼´æä¾›å¸¦è‡ªå·±å“ç‰Œçš„ç³»ç»Ÿ | OEM è½¯ä»¶ |

---

## ğŸ—ï¸ ç§Ÿæˆ·æ¶æ„

### æ¶æ„æ¨¡å¼

#### æ¨¡å¼ 1: å…±äº«æ•°æ®åº“ + è¡Œçº§éš”ç¦»ï¼ˆOneID é»˜è®¤ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         OneID Database              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Users                              â”‚
â”‚  â”œâ”€ id, email, tenant_id â—„â”€â”€â”€â”€â”€â”   â”‚
â”‚  â””â”€ ...                         â”‚   â”‚
â”‚                                 â”‚   â”‚
â”‚  Clients                        â”‚   â”‚
â”‚  â”œâ”€ id, name, tenant_id â—„â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â””â”€ ...                         â”‚   â”‚
â”‚                                 â”‚   â”‚
â”‚  Settings                       â”‚   â”‚
â”‚  â”œâ”€ key, value, tenant_id â—„â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â””â”€ ...                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹ç‚¹**ï¼š
- âœ… æˆæœ¬æœ€ä½
- âœ… ç»´æŠ¤ç®€å•
- âœ… èµ„æºåˆ©ç”¨ç‡é«˜
- âš ï¸ éœ€è¦ä¸¥æ ¼çš„å®‰å…¨æ§åˆ¶

#### æ¨¡å¼ 2: ç‹¬ç«‹æ•°æ®åº“ï¼ˆæœªæ¥æ”¯æŒï¼‰

```
Tenant A â†’ Database A
Tenant B â†’ Database B
Tenant C â†’ Database C
```

**ç‰¹ç‚¹**ï¼š
- âœ… æ•°æ®å®Œå…¨éš”ç¦»
- âœ… å¯ç‹¬ç«‹å¤‡ä»½æ¢å¤
- âš ï¸ æˆæœ¬è¾ƒé«˜
- âš ï¸ ç»´æŠ¤å¤æ‚

---

### ç§Ÿæˆ·æ•°æ®æ¨¡å‹

```csharp
// OneID.Shared/Domain/Tenant.cs

public class Tenant
{
    public Guid Id { get; set; }
    public string Name { get; set; }            // ç§Ÿæˆ·åç§°
    public string Slug { get; set; }            // URL æ ‡è¯†ï¼ˆå”¯ä¸€ï¼‰
    public string? Domain { get; set; }         // è‡ªå®šä¹‰åŸŸå
    public bool IsActive { get; set; }          // æ˜¯å¦æ¿€æ´»
    
    // å“ç‰Œé…ç½®
    public string? LogoUrl { get; set; }
    public string? PrimaryColor { get; set; }
    public string? BackgroundColor { get; set; }
    
    // è®¢é˜…ä¿¡æ¯
    public string Plan { get; set; }            // å¥—é¤ç±»å‹
    public int MaxUsers { get; set; }           // ç”¨æˆ·æ•°é‡é™åˆ¶
    public DateTime? SubscriptionExpiresAt { get; set; }
    
    // å®¡è®¡å­—æ®µ
    public DateTime CreatedAt { get; set; }
    public DateTime UpdatedAt { get; set; }
}
```

---

## ğŸš€ å®ç°æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: å­åŸŸåè·¯ç”±ï¼ˆæ¨èï¼‰

**ç‰¹ç‚¹**ï¼šæ¯ä¸ªç§Ÿæˆ·æœ‰ç‹¬ç«‹çš„å­åŸŸå

**ç¤ºä¾‹**ï¼š
- `acme.yourdomain.com` â†’ Acme å…¬å¸
- `contoso.yourdomain.com` â†’ Contoso å…¬å¸

#### 1. é…ç½® DNS

```
*.yourdomain.com â†’ Your Application IP
```

#### 2. ç§Ÿæˆ·è¯†åˆ«ä¸­é—´ä»¶

```csharp
// TenantResolutionMiddleware.cs

public class TenantResolutionMiddleware
{
    private readonly RequestDelegate _next;

    public TenantResolutionMiddleware(RequestDelegate next)
    {
        _next = next;
    }

    public async Task InvokeAsync(HttpContext context, AppDbContext dbContext)
    {
        // ä»å­åŸŸåæå–ç§Ÿæˆ·æ ‡è¯†
        var host = context.Request.Host.Host;
        var subdomain = ExtractSubdomain(host);

        if (string.IsNullOrEmpty(subdomain))
        {
            // ä¸»åŸŸåï¼Œè·³è¿‡ç§Ÿæˆ·è¯†åˆ«
            await _next(context);
            return;
        }

        // æŸ¥æ‰¾ç§Ÿæˆ·
        var tenant = await dbContext.Tenants
            .FirstOrDefaultAsync(t => t.Slug == subdomain && t.IsActive);

        if (tenant == null)
        {
            context.Response.StatusCode = 404;
            await context.Response.WriteAsync("Tenant not found");
            return;
        }

        // å­˜å‚¨ç§Ÿæˆ·ä¸Šä¸‹æ–‡
        context.Items["TenantId"] = tenant.Id;
        context.Items["Tenant"] = tenant;

        await _next(context);
    }

    private string? ExtractSubdomain(string host)
    {
        // ç¤ºä¾‹ï¼šacme.yourdomain.com â†’ acme
        var parts = host.Split('.');
        
        if (parts.Length >= 3)
        {
            return parts[0];
        }

        return null;
    }
}
```

#### 3. ç§Ÿæˆ·ä¸Šä¸‹æ–‡æœåŠ¡

```csharp
// ITenantContext.cs

public interface ITenantContext
{
    Guid? TenantId { get; }
    Tenant? Tenant { get; }
}

public class TenantContext : ITenantContext
{
    private readonly IHttpContextAccessor _httpContextAccessor;

    public TenantContext(IHttpContextAccessor httpContextAccessor)
    {
        _httpContextAccessor = httpContextAccessor;
    }

    public Guid? TenantId =>
        _httpContextAccessor.HttpContext?.Items["TenantId"] as Guid?;

    public Tenant? Tenant =>
        _httpContextAccessor.HttpContext?.Items["Tenant"] as Tenant;
}
```

#### 4. è‡ªåŠ¨è¿‡æ»¤æŸ¥è¯¢

```csharp
// AppDbContext.cs

public class AppDbContext : IdentityDbContext<AppUser>
{
    private readonly ITenantContext _tenantContext;

    public AppDbContext(
        DbContextOptions<AppDbContext> options,
        ITenantContext tenantContext) : base(options)
    {
        _tenantContext = tenantContext;
    }

    protected override void OnModelCreating(ModelBuilder builder)
    {
        base.OnModelCreating(builder);

        // ä¸ºæ‰€æœ‰å¤šç§Ÿæˆ·å®ä½“æ·»åŠ å…¨å±€è¿‡æ»¤å™¨
        foreach (var entityType in builder.Model.GetEntityTypes())
        {
            var tenantIdProperty = entityType.FindProperty("TenantId");
            if (tenantIdProperty != null)
            {
                var parameter = Expression.Parameter(entityType.ClrType, "e");
                var property = Expression.Property(parameter, "TenantId");
                var tenantId = Expression.Property(
                    Expression.Constant(_tenantContext),
                    nameof(ITenantContext.TenantId)
                );
                
                var body = Expression.Equal(property, tenantId);
                var lambda = Expression.Lambda(body, parameter);

                builder.Entity(entityType.ClrType).HasQueryFilter(lambda);
            }
        }
    }
}
```

---

### æ–¹æ¡ˆ 2: è·¯å¾„è·¯ç”±

**ç‰¹ç‚¹**ï¼šä½¿ç”¨ URL è·¯å¾„æ ‡è¯†ç§Ÿæˆ·

**ç¤ºä¾‹**ï¼š
- `yourdomain.com/tenants/acme/...`
- `yourdomain.com/tenants/contoso/...`

#### å®ç°

```csharp
// TenantFromPathMiddleware.cs

public class TenantFromPathMiddleware
{
    private readonly RequestDelegate _next;

    public TenantFromPathMiddleware(RequestDelegate next)
    {
        _next = next;
    }

    public async Task InvokeAsync(HttpContext context, AppDbContext dbContext)
    {
        var path = context.Request.Path.Value;
        
        // åŒ¹é… /tenants/{slug}/...
        var match = Regex.Match(path, @"^/tenants/([^/]+)");
        
        if (!match.Success)
        {
            await _next(context);
            return;
        }

        var slug = match.Groups[1].Value;

        // æŸ¥æ‰¾ç§Ÿæˆ·
        var tenant = await dbContext.Tenants
            .FirstOrDefaultAsync(t => t.Slug == slug && t.IsActive);

        if (tenant == null)
        {
            context.Response.StatusCode = 404;
            await context.Response.WriteAsync("Tenant not found");
            return;
        }

        // å­˜å‚¨ç§Ÿæˆ·ä¸Šä¸‹æ–‡
        context.Items["TenantId"] = tenant.Id;
        context.Items["Tenant"] = tenant;

        // é‡å†™è·¯å¾„ï¼ˆå»æ‰ /tenants/{slug}ï¼‰
        context.Request.Path = path.Substring(match.Length);

        await _next(context);
    }
}
```

---

### æ–¹æ¡ˆ 3: Header è·¯ç”±

**ç‰¹ç‚¹**ï¼šé€šè¿‡ HTTP Header ä¼ é€’ç§Ÿæˆ·æ ‡è¯†

**ç¤ºä¾‹**ï¼š
```http
GET /api/users HTTP/1.1
Host: api.yourdomain.com
X-Tenant-ID: acme
```

#### å®ç°

```csharp
public class TenantFromHeaderMiddleware
{
    private readonly RequestDelegate _next;

    public TenantFromHeaderMiddleware(RequestDelegate next)
    {
        _next = next;
    }

    public async Task InvokeAsync(HttpContext context, AppDbContext dbContext)
    {
        if (!context.Request.Headers.TryGetValue("X-Tenant-ID", out var tenantSlug))
        {
            await _next(context);
            return;
        }

        var tenant = await dbContext.Tenants
            .FirstOrDefaultAsync(t => t.Slug == tenantSlug && t.IsActive);

        if (tenant == null)
        {
            context.Response.StatusCode = 404;
            await context.Response.WriteAsync("Tenant not found");
            return;
        }

        context.Items["TenantId"] = tenant.Id;
        context.Items["Tenant"] = tenant;

        await _next(context);
    }
}
```

---

## ğŸ” ç§Ÿæˆ·æ•°æ®éš”ç¦»

### 1. Repository æ¨¡å¼

```csharp
// IUserRepository.cs

public interface IUserRepository
{
    Task<AppUser?> GetByIdAsync(string id);
    Task<List<AppUser>> GetAllAsync();
    Task<AppUser> CreateAsync(AppUser user);
}

public class UserRepository : IUserRepository
{
    private readonly AppDbContext _context;
    private readonly ITenantContext _tenantContext;

    public UserRepository(AppDbContext context, ITenantContext tenantContext)
    {
        _context = context;
        _tenantContext = tenantContext;
    }

    public async Task<AppUser?> GetByIdAsync(string id)
    {
        // è‡ªåŠ¨è¿‡æ»¤å½“å‰ç§Ÿæˆ·çš„æ•°æ®
        return await _context.Users
            .FirstOrDefaultAsync(u => u.Id == id && u.TenantId == _tenantContext.TenantId);
    }

    public async Task<List<AppUser>> GetAllAsync()
    {
        // ä»…è¿”å›å½“å‰ç§Ÿæˆ·çš„ç”¨æˆ·
        return await _context.Users
            .Where(u => u.TenantId == _tenantContext.TenantId)
            .ToListAsync();
    }

    public async Task<AppUser> CreateAsync(AppUser user)
    {
        // è‡ªåŠ¨è®¾ç½®ç§Ÿæˆ· ID
        user.TenantId = _tenantContext.TenantId;
        
        _context.Users.Add(user);
        await _context.SaveChangesAsync();
        
        return user;
    }
}
```

### 2. API æ§åˆ¶å™¨

```csharp
// UsersController.cs

[ApiController]
[Route("api/users")]
[Authorize]
public class UsersController : ControllerBase
{
    private readonly IUserRepository _userRepository;
    private readonly ITenantContext _tenantContext;

    public UsersController(
        IUserRepository userRepository,
        ITenantContext tenantContext)
    {
        _userRepository = userRepository;
        _tenantContext = tenantContext;
    }

    [HttpGet]
    public async Task<IActionResult> GetUsers()
    {
        // è‡ªåŠ¨éš”ç¦»ç§Ÿæˆ·æ•°æ®
        var users = await _userRepository.GetAllAsync();
        
        return Ok(new
        {
            TenantId = _tenantContext.TenantId,
            TenantName = _tenantContext.Tenant?.Name,
            Users = users
        });
    }

    [HttpPost]
    public async Task<IActionResult> CreateUser([FromBody] CreateUserDto dto)
    {
        var user = new AppUser
        {
            Email = dto.Email,
            UserName = dto.Username,
            // TenantId ä¼šåœ¨ Repository ä¸­è‡ªåŠ¨è®¾ç½®
        };

        var createdUser = await _userRepository.CreateAsync(user);
        
        return CreatedAtAction(nameof(GetUsers), new { id = createdUser.Id }, createdUser);
    }
}
```

---

## ğŸ¨ ç§Ÿæˆ·è‡ªå®šä¹‰å“ç‰Œ

### 1. ç™»å½•é¡µå®šåˆ¶

```typescript
// src/lib/tenantConfig.ts

export interface TenantConfig {
  id: string;
  name: string;
  slug: string;
  logoUrl?: string;
  primaryColor?: string;
  backgroundColor?: string;
}

export async function getTenantConfig(): Promise<TenantConfig | null> {
  // ä»å­åŸŸåè·å–ç§Ÿæˆ·ä¿¡æ¯
  const subdomain = getSubdomain();
  
  if (!subdomain) {
    return null;
  }

  try {
    const response = await fetch(`http://localhost:5001/api/tenants/by-slug/${subdomain}`);
    
    if (!response.ok) {
      return null;
    }

    return await response.json();
  } catch (error) {
    console.error('Failed to load tenant config:', error);
    return null;
  }
}

function getSubdomain(): string | null {
  const hostname = window.location.hostname;
  const parts = hostname.split('.');
  
  if (parts.length >= 3) {
    return parts[0];
  }
  
  return null;
}
```

```typescript
// src/pages/LoginPage.tsx

export function LoginPage() {
  const [tenantConfig, setTenantConfig] = useState<TenantConfig | null>(null);

  useEffect(() => {
    loadTenantConfig();
  }, []);

  const loadTenantConfig = async () => {
    const config = await getTenantConfig();
    setTenantConfig(config);
    
    // åº”ç”¨ç§Ÿæˆ·æ ·å¼
    if (config) {
      applyTenantStyles(config);
    }
  };

  const applyTenantStyles = (config: TenantConfig) => {
    if (config.primaryColor) {
      document.documentElement.style.setProperty('--primary-color', config.primaryColor);
    }
    if (config.backgroundColor) {
      document.documentElement.style.setProperty('--bg-color', config.backgroundColor);
    }
  };

  return (
    <div className="login-page">
      {tenantConfig?.logoUrl && (
        <img src={tenantConfig.logoUrl} alt={tenantConfig.name} />
      )}
      
      <h1>æ¬¢è¿ç™»å½• {tenantConfig?.name || 'OneID'}</h1>
      
      {/* ç™»å½•è¡¨å• */}
    </div>
  );
}
```

### 2. åŠ¨æ€æ ·å¼

```css
/* tenant-styles.css */

:root {
  --primary-color: #3b82f6;
  --bg-color: #ffffff;
  --text-color: #1f2937;
}

.btn-primary {
  background-color: var(--primary-color);
}

.login-page {
  background-color: var(--bg-color);
  color: var(--text-color);
}
```

---

## ğŸ“Š ç§Ÿæˆ·ç®¡ç† API

### åˆ›å»ºç§Ÿæˆ·

```typescript
// POST /api/tenants
const newTenant = await fetch('http://localhost:5002/api/tenants', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${adminToken}`,
  },
  body: JSON.stringify({
    name: 'Acme Corporation',
    slug: 'acme',
    domain: 'acme.com',
    plan: 'enterprise',
    maxUsers: 1000,
  }),
});
```

### æŸ¥è¯¢ç§Ÿæˆ·

```typescript
// GET /api/tenants/{id}
const tenant = await fetch(`http://localhost:5002/api/tenants/${tenantId}`, {
  headers: {
    'Authorization': `Bearer ${adminToken}`,
  },
});
```

### æ›´æ–°ç§Ÿæˆ·é…ç½®

```typescript
// PUT /api/tenants/{id}
await fetch(`http://localhost:5002/api/tenants/${tenantId}`, {
  method: 'PUT',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${adminToken}`,
  },
  body: JSON.stringify({
    logoUrl: 'https://cdn.example.com/logos/acme.png',
    primaryColor: '#ff0000',
    maxUsers: 2000,
  }),
});
```

---

## âœ… æœ€ä½³å®è·µ

### 1. ç§Ÿæˆ·æ•°æ®å®‰å…¨

```csharp
// âœ… å¥½çš„åšæ³•ï¼šä½¿ç”¨å…¨å±€æŸ¥è¯¢è¿‡æ»¤å™¨
protected override void OnModelCreating(ModelBuilder builder)
{
    builder.Entity<AppUser>()
        .HasQueryFilter(u => u.TenantId == _tenantContext.TenantId);
}

// âŒ åçš„åšæ³•ï¼šæ‰‹åŠ¨è¿‡æ»¤ï¼ˆå®¹æ˜“é—æ¼ï¼‰
var users = await _context.Users
    .Where(u => u.TenantId == tenantId) // å®¹æ˜“å¿˜è®°
    .ToListAsync();
```

### 2. è·¨ç§Ÿæˆ·æ“ä½œä¿æŠ¤

```csharp
// âœ… å¥½çš„åšæ³•ï¼šéªŒè¯ç§Ÿæˆ·æƒé™
public async Task<AppUser?> GetUserAsync(string userId)
{
    var user = await _context.Users.FindAsync(userId);
    
    if (user != null && user.TenantId != _tenantContext.TenantId)
    {
        throw new UnauthorizedAccessException("Access denied");
    }
    
    return user;
}
```

### 3. ç§Ÿæˆ·é…é¢ç®¡ç†

```csharp
// æ£€æŸ¥ç”¨æˆ·æ•°é‡é™åˆ¶
public async Task<bool> CanCreateUser()
{
    var tenant = _tenantContext.Tenant;
    var currentUserCount = await _context.Users
        .CountAsync(u => u.TenantId == tenant.Id);
    
    return currentUserCount < tenant.MaxUsers;
}
```

### 4. æ€§èƒ½ä¼˜åŒ–

```csharp
// âœ… ç¼“å­˜ç§Ÿæˆ·é…ç½®
private readonly IMemoryCache _cache;

public async Task<Tenant?> GetTenantAsync(Guid tenantId)
{
    return await _cache.GetOrCreateAsync(
        $"tenant:{tenantId}",
        async entry =>
        {
            entry.AbsoluteExpirationRelativeToNow = TimeSpan.FromMinutes(10);
            return await _context.Tenants.FindAsync(tenantId);
        }
    );
}
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ 1: ç§Ÿæˆ·è¯†åˆ«å¤±è´¥

**ç—‡çŠ¶**ï¼šæ— æ³•æ­£ç¡®è¯†åˆ«ç§Ÿæˆ·

**æ’æŸ¥**ï¼š
1. æ£€æŸ¥ä¸­é—´ä»¶æ³¨å†Œé¡ºåº
2. éªŒè¯ DNS é…ç½®
3. æŸ¥çœ‹æ—¥å¿—ä¸­çš„ Host ä¿¡æ¯

### é—®é¢˜ 2: è·¨ç§Ÿæˆ·æ•°æ®æ³„æ¼

**åŸå› **ï¼šæŸ¥è¯¢è¿‡æ»¤å™¨æœªç”Ÿæ•ˆ

**è§£å†³**ï¼š
1. ç¡®ä¿æ‰€æœ‰å®ä½“éƒ½æœ‰ `TenantId` å­—æ®µ
2. æ£€æŸ¥å…¨å±€æŸ¥è¯¢è¿‡æ»¤å™¨é…ç½®
3. ä½¿ç”¨ Repository æ¨¡å¼ç»Ÿä¸€æ•°æ®è®¿é—®

### é—®é¢˜ 3: æ€§èƒ½é—®é¢˜

**åŸå› **ï¼šé¢‘ç¹æŸ¥è¯¢ç§Ÿæˆ·ä¿¡æ¯

**è§£å†³**ï¼š
1. å¯ç”¨ç§Ÿæˆ·é…ç½®ç¼“å­˜
2. ä½¿ç”¨ Connection Pooling
3. è€ƒè™‘ä½¿ç”¨ç‹¬ç«‹æ•°æ®åº“æ¨¡å¼

---

## ğŸ“š ç›¸å…³èµ„æº

- [æ ‡å‡† OIDC é›†æˆ](./é›†æˆæŒ‡å—_01_æ ‡å‡†OIDCé›†æˆ.md)
- [è´¦å·ç»Ÿä¸€ç®¡ç†](./é›†æˆæŒ‡å—_03_è´¦å·ç»Ÿä¸€ç®¡ç†.md)
- [Multi-Tenancy Patterns](https://docs.microsoft.com/en-us/azure/architecture/patterns/multi-tenancy)

---

## ğŸ¯ æ€»ç»“

**å¤šç§Ÿæˆ·é›†æˆçš„å…³é”®è¦ç‚¹**ï¼š

1. âœ… é€‰æ‹©åˆé€‚çš„ç§Ÿæˆ·è¯†åˆ«æ–¹å¼ï¼ˆå­åŸŸå/è·¯å¾„/Headerï¼‰
2. âœ… å®æ–½ä¸¥æ ¼çš„æ•°æ®éš”ç¦»
3. âœ… ä½¿ç”¨å…¨å±€æŸ¥è¯¢è¿‡æ»¤å™¨
4. âœ… æä¾›ç§Ÿæˆ·çº§é…ç½®ç®¡ç†
5. âœ… ç›‘æ§ç§Ÿæˆ·é…é¢å’Œä½¿ç”¨æƒ…å†µ
6. âœ… ä¼˜åŒ–æ€§èƒ½ï¼ˆç¼“å­˜ã€ç´¢å¼•ï¼‰

**OneID çš„å¤šç§Ÿæˆ·ä¼˜åŠ¿**ï¼š

- ğŸ¯ å¼€ç®±å³ç”¨çš„ç§Ÿæˆ·éš”ç¦»
- ğŸ¨ çµæ´»çš„å“ç‰Œå®šåˆ¶
- âš™ï¸ å®Œæ•´çš„ç§Ÿæˆ·ç®¡ç† API
- ğŸ”’ è¡Œçº§æ•°æ®å®‰å…¨

Happy Building! ğŸš€

